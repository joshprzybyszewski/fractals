<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Fractal App</title>
    <style>
        .drawings {
            /* display: flex; */
            /* flex-wrap: wrap; */
            justify-content: space-between;
        }

        .drawingcontainer {
            overflow: scroll;
        }

        .fractal {
            display: inline-block;
            vertical-align: middle;
            align-content: center;
            overflow: visible;
        }

        .dragonfractal {
            /* background-color: cornflowerblue; */
        }

        .dragonfractal>.fractal>path {
            fill: none;
            stroke: gold;
            stroke-width: 1;
            stroke-linejoin: round;
        }
    </style>
</head>

<body>
    <input type="number" id="numSteps" min="0" />
    <button id="run">Run</button>
    <button id="close">Shutdown app</button>
    <br />

    <div class="drawings" style="width: 500px; height: 500px;">
        <div class="dragonfractal drawingcontainer">
            <svg viewBox="0 0 200 200" class="fractal" xmlns="http://www.w3.org/2000/svg">
                <path id="pathID" d="M 0 0 h 10 v -10 h -10 v -10 h -10 v 10 h -10 v -10" />
            </svg>
        </div>
    </div>

    <h3>
        Debug
    </h3>
    <div id="status"></div>


    <script src="wasm_exec.js"></script>
    <script>
        const go = new Go();
        // memoryBytes is an Uint8Array pointing to the webassembly linear memory.
        let memoryBytes;
        let mod, inst, bytes;
        let imageType;
        document.getElementById('status').innerText = "Initializing wasm...";
        WebAssembly.instantiateStreaming(
            fetch("fractals.wasm"), go.importObject).then((result) => {
                mod = result.module;
                inst = result.instance;
                memoryBytes = new Uint8Array(inst.exports.mem.buffer)
                document.getElementById('status').innerText = "Initialization complete.";
                run();
            }).catch((err) => {
                console.error(err);
            });

        async function run() {
            await go.run(inst);
        }
    </script>
</body>

</html>